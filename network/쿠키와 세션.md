### 출처
*  [웹사이트에서 동의를 요구하는 이유](https://www.donga.com/news/It/article/all/20200320/100259582/1)
* [세션 VS 쿠키](https://medium.com/@hendelRamzy/how-session-and-cookies-works-640fb3f349d1)
___
### 개요
* [[#쿠키]]
* [[#비 필수 쿠키 조금 더 뜯어보기]]
* [[#쿠키로 상태 저장하기]]
* [[#쿠키의 구조]]
* [[#왜 이렇게 쿠키를 허가 해달라고 할까?]]
* [[#세션]]
___
### 쿠키

<span class="red red-bg">쿠키는 사용자를 식별하고 정보를 유지하는 방식 중에서 현재까지 가장 널리 사용 되는 방식이다. 쿠키는 하나의 파일로 다양한 웹 사이트로 부터 생성돼 유저의 브라우저 내부에 저장된다. </span>쿠키는 우선 그 용도에 따라 필수 쿠키와 비 필수 쿠키로 구분할 수 있다.

* **필수 쿠키**
	필수 쿠키는 **웹 사이트 활용에 도움을주거나 필수적으로 요구되는 쿠키를 말하며 유저 맞춤 설정을 해주거나 로그인 세션 유지 등을 목적으로 활용**된다.  

* **비 필수 쿠키**
	해당 쿠키는 브라우저의 활동을 감시하며 특정 웹서버나 마켓터가 당신이 방문한 사이트를 확인할 수 있게 한다. **비 필수 쿠키에는 클릭이나 방문 시간 등의 데이터가 저장되며 구글 애드는 이러한 데이터를 분석해 유저 맞춤형 광고를 추천**해 준다.

#### 비 필수 쿠키 조금 더 뜯어보기
비 필수 쿠키는 주로 에드테크 업체에서 제공하며 이들은 이 쿠키를 통해 유저를 파악하고 맞춤형 광고를 전달한다. 비 필수 쿠키의 예시로는 아래와 같은 친구들이 존재하며 이런 **쿠키들이 해당 사이트에서 발생한 나의 활동을 추적하고 있다가 추후 다른 사이트에서 불현듯 맞춤형 광고를 추천**해 준다. (이는 쿠팡에서 사용하는 쿠키들이다)

![https://www.cookieserve.com/scan-summary/?url=https%3A%2F%2Fwww.coupang.com%2F](https://my-study.s3.ap-northeast-2.amazonaws.com/%EC%BF%A0%ED%82%A4%EC%99%80%20%EC%84%B8%EC%85%98%20/%20%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-04-03%20%EC%98%A4%ED%9B%84%204.39.28.png)

이러한 비 필수 쿠키는 대부분 접속한 도메인이 아닌 외부 도메인에서 사용하는 서드 파티 쿠키인데 이와 관련해 최근 구글에서 쇼킹한 입장을 표명했다. **2024년 부터 서드 파티 쿠키의 사용을 크롬 브라우저에서 전면 금지하는 정책**인데 이로 인해 에드테크 회사와 광고를 통해 주로 매출을 올리는 언론사에 큰 충격이 가해질 것으로 보인다. [관련 기사](https://www.hankyung.com/article/2024010552681)

쿠키는 또한 저장되는 시간에 따라 세션쿠키와 지속 쿠키로 구분할 수 있다. 
#### *세션 쿠키*
**세션 쿠키는 사용자가 브라우저를 닫는 순간 삭제되며 디스크에 저장되지 않고 메모리에 저장돼 동작한다.** 세션 쿠키는 주로 유저를 트래킹하거나 유저의 상태를 기록하는 용도로 사용된다. 서버는 해당 쿠키를 통해 유저의 히스토리를 파악하고 이에 따라 적절한 처리를 진행 해준다. 세션 쿠키의 대표적인 예시로는 비회원 장바구니를 생각해 볼 수 있다. 

![https://www.cookieyes.com/blog/session-cookies/](https://my-study.s3.ap-northeast-2.amazonaws.com/%EC%BF%A0%ED%82%A4%EC%99%80%20%EC%84%B8%EC%85%98%20/%20Pasted%20image%2020240403165949.png)

#### *지속 쿠키*
지속쿠키는 메모리가 아닌 디스크에 저장되는 쿠키로 만기기한이 도달하기 이전까지는 파기되지 않는 쿠키를 말한다. 세션 쿠키와는 파기 시점과 저장되는 위치 말고는 모든 것이 동일하다.

>[!info]
>**쿠키는 웹 어플리케이션에서 상태를 저장하는 기법**중 하나로 **클라이언트에 저장되는 작은 파일을 의미한다. 로그인 유지나 사용자 트래킹에 주로 활용**된다.

____
### 쿠키로 상태 저장하기

<u><b>쿠키의 기본적인 발상은 브라우저가 상태를 저장하고 사용자가 추후 통신을 진행할 때 마다 지금까지의 상태를 같이 전송하는 것이다.</b></u> HTTP는 Stateless하기 때문에 상태를 갖는 웹 어플리케션을 활용하기 위해선 별도의 저장 공간이 필요하다. 

**쿠키는 이를 극복하기 위한 수단으로 쿠키 자체에 데이터를 저장해 매 요청마다 전송을 해 상태를 파악하게 하거나 쿠키에 존재하는 데이터를 통해 외부 저장소에 접근해 지금까지의 데이터를 파악하게 할 수 있다.**

![400](https://my-study.s3.ap-northeast-2.amazonaws.com/%EC%BF%A0%ED%82%A4%EC%99%80%20%EC%84%B8%EC%85%98%20/%20%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-04-03%20%EC%98%A4%ED%9B%84%205.24.13.png)
___
### 쿠키의 구조

쿠키는 다음과 같은 구조로 생겼다. **쿠키는 이름, 값, 도메인, 경로를 가지며 이를 활용해 특정 도메인에서만 쿠키를 전달하거나 특정 경로에 해당하는 URL에만 쿠키를 전달할 수 있다.**

![400](https://my-study.s3.ap-northeast-2.amazonaws.com/%EC%BF%A0%ED%82%A4%EC%99%80%20%EC%84%B8%EC%85%98%20/%20%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-04-03%20%EC%98%A4%ED%9B%84%206.00.22.png)

쿠키는 크롬 개발자 도구를 활용해 확인할 수 있고 만약 디스크에 저장된 쿠키를 확인하고 싶으면 아래 코드를 실행해 sqlite에서 관리하는 쿠키 값을 읽으면 된다.

```python
import sqlite3

filename =("/Users/{YOUR_USER_NAME}/Library/ApplicationSupport/Google/Chrome/Default/Cookies"  # EDIT ME
)
connection = sqlite3.connect(filename)
cursor = connection.cursor()
cursor.execute("SELECT * FROM cookies;")
results = cursor.fetchall()

for r in results:
    link = r[2]
    data = r[5]
    if len(link):
        print(f"site: {link} value: {data}")


cursor.close()
connection.close()

```

코드를 실행해보면 브라우저가 수백 개의 쿠키를 확보하고 있는 것을 확인할 수 있다. 이렇게나 많은 양의 쿠키를 모든 사이트에 전송하는 것은 오버헤드가 크기 때문에 **브라우저는 보통 해당 도메인이 생성한 쿠키만을 전송한다.**
___
### 왜 이렇게 쿠키를 허가 해달라고 할까?

쿠키는 유저의 방문 기록이나 설정등의 정보를 갖고 있기 때문에 웹 사이트를 개선하는 정보로 유용하게 사용할 수 있다. 예를 들어 스택 오버플로우 등에서 유저의 방문 기록을 토대로 이 사람이 관심있어할 만한 채용 공고나 질문 들을 추천해주는 기능들이 그렇다.

하지만, **쿠키에는 개인 정보가 담기기 때문에 무분별한 쿠키 허용은 곧 사생활 침해 문제를 야기할 수도 있다.** 실제로 아래 이미지를 보면 쿠키를 허용할 경우 나의 SNS에 맞춤형 광고를 노출한다고 표기돼 있다.

<b><u>웹 사이트의 관점에서 바라보면 사이트를 더욱 개선하거나 광고 클릭율을 증대 시킬 수 있으므로 쿠키를 허가 받는 것이 유리하다.</u></b>

![https://www.donga.com/news/It/article/all/20200320/100259582/1](https://my-study.s3.ap-northeast-2.amazonaws.com/%EC%BF%A0%ED%82%A4%EC%99%80%20%EC%84%B8%EC%85%98%20/%20Pasted%20image%2020240403215728.png)
___
### 세션

<span class="red red-bg">세션은 매번 많은 데이터를 전송해야 하는 쿠키의 단점을 개선하기 위해 등장한 방법으로 특정한 유저의 정보를 서버에 저장하고 이를 특정한 id 값을 토대로 찾을 수 있게한다. </span>이에 따라 클라이언트는 많은 데이터를 전송할 필요 없이 세션 id만 전송해도 많은 정보를 전부 전달하는 것이 가능해졌다.

**세션의 핵심은 정보를 클라이언트 사이드가 아닌 서버에 저장하는 것**이다. 정보를 메모리에 저장할지 디스크에 저장할지 DB에 저장 할지는 전부 사용자가 어떻게 구현 하느냐에 달려있다.

세션을 사용하는 방식의 가장 큰 단점은 만약 **세션을 서버 자체 메모리에 저장할 경우 기존의 Stateful에서 발생했던 이슈가 재발**할 수 있다는 것이다. 이 방법을 원치 않을 경우 **외부에 세션 저장소를 별도로 생성하고 관리해야 하는데 이 작업 또한 오버헤드가 발생**한다.

세션을 사용한 통신은 아래 이미지와 같은 방식으로 진행된다. 유저가 로그인을 진행하고 로그인이 성사되면 해당 유저만의 세션 ID를 생성하고 Set-Cookie 헤더에 저장해 반환한다. 만들어진 세션 ID는 서버의 어느 곳에 저장된다. 이후 유저는 매 요청마다 ID를 같이 전송하고 서버는 이를 확인해 유저의 로그인 여부를 판별하고 서비스를 제공한다.

![https://medium.com/@hendelRamzy/how-session-and-cookies-works-640fb3f349d1](https://my-study.s3.ap-northeast-2.amazonaws.com/%EC%BF%A0%ED%82%A4%EC%99%80%20%EC%84%B8%EC%85%98%20/%20Pasted%20image%2020240403223901.png)
