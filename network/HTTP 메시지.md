#http #applicationlayer 
### 출처
*  HTTP 완벽 가이드
* [장환곤 노션](https://www.notion.so/3-HTTP-3b96e15795b1447fb530d9f4763a7bb4?pvs=4)
* [MDN HTTP MESSAGE](https://developer.mozilla.org/ko/docs/Web/HTTP/Messages)
___
### 개요
* [[#HTTP 메시지]]
* [[#HTTP 메시지의 흐름]]
* [[#HTTP 메시지의 구조]]
* [[#HTTP 요청]]
* [[#HTTP 응답]]
* [[#상태코드 조금 더 자세히]]
___
### HTTP 메시지

<u><b>HTTP 메시지는 HTTP 애플리케이션에서 주고 받는 데이터 블록을 의미한다. </b></u>
이 블록에는 메시지의 내용과 의미를 설명하는 메타 데이터가 저장돼 있으며 메시지는 클라이언트로 부터 프록시를 거쳐 서버로 향한다.
___
### HTTP 메시지의 흐름

메시지는 단일한 방향으로 전달된다. 캐시나 방화벽 같은 이슈가 없는 이상 메시지는 프록시를 타고 서버로 전달된다.
마찬가지로 응답 역시 큰 문제가 없는 이상 단일한 방향으로 클라이언트에게 전달된다.

* **인바운드: 클라이언트 -> 서버**
* **아웃 바운드: 서버 -> 클라이언트**

AWS 보안 그룹을 설정하다보면 인,아웃 바운드를 설정하는 화면을 볼 수 있다. 
![](https://my-study.s3.ap-northeast-2.amazonaws.com/HTTP%20%EB%A9%94%EC%8B%9C%EC%A7%80%20/%20Pasted%20image%2020240311182556.png)
___
### HTTP 메시지의 구조

**HTTP 메시지는 시작줄, 헤더블록, 본문 총 3가지의 구성으로 분리되며 시작줄이 메세지의 타입을 헤드 블록이 속성을 본문이 데이터를 서술**한다. 각 줄은 캐리지 리턴 혹은 개행 문자로 구분돼 있다. 아래는 HTTP 메세지의 예시이다.

![](https://my-study.s3.ap-northeast-2.amazonaws.com/HTTP%20%EB%A9%94%EC%8B%9C%EC%A7%80%20/%20Pasted%20image%2020240311200028.png)

모든 HTTP 메세지는 요청 메시지 혹은 응답 메시지로 구분되며 각 메시지의 형태는 아래와 같다.
![](https://my-study.s3.ap-northeast-2.amazonaws.com/HTTP%20%EB%A9%94%EC%8B%9C%EC%A7%80%20/%20Pasted%20image%2020240311200048.png)
___
### HTTP 요청

==**HTTP 요청은 서버가 특정 동작을 취하게끔 만들기 위해 클라이언트에서 전송하는 메시지이다.*== 요청 메세지의 구성 요소는 다음과 같다.

```text
<메서드><요청 URL><버전>
<헤더>
<엔티티 본문>
```
#### 메서드
메서드는 서버가 수행할 동작을 의미한다. 타겟은 URL을 의미한다. 버전은 HTTP 응답 메시지가 사용할 버전을 지정한다.
#### 헤더
헤더는 HTTP 메시지에서 사용하는 속성 데이터를 의미하며 HTTP에서 기본으로 제공하는 헤더와 자체 헤더로 구분할 수 있다. 헤더는 `key:value` 의 형태로 작성한다.
![](https://my-study.s3.ap-northeast-2.amazonaws.com/HTTP%20%EB%A9%94%EC%8B%9C%EC%A7%80%20/%20Pasted%20image%2020240311200858.png)

#### 본문
본문은 요청의 마지막 부분에 들어가며 **모든 요청이 본문을 필요로 하진 않는다.** GET, DELETE, OPTIONS와 같은 메서드는 본문을 포함하지 않는다. 하지만 **POST, PUT의 경우 본문 영역을 소유하고 있는데 이는 업데이트를 진행하기 위한 데이터 저장이 필요하기 때문**이다.
**본문 영역에는 인코딩된 실질적인 전송을 위한 데이터가 저장된다.**
___
### HTTP 응답

요청에 대한 서버의 응답을 반환하는 메시지로 다음과 같은 형태를 띄고있다.
```text
<버전><상태코드><사유 구절>
<헤더>
<엔티티 본문>
```

응답 메시지의 첫째줄은 상태 줄이라고 하며 요청에 대한 서버의 응답을 요약해서 확인할 수 있다. 
#### 상태 코드
상태 코드는 응답의 결과를 즉각적으로 나타내는 숫자로 다음의 상태 코드들이 유명하다. 200, 404, 302, 500.

#### 헤더
응답 헤더는 요청헤더와 동일한 형태를 띈다. 응답에서만 사용할 수 있는 응답헤더가 존재하며 대표적으로 `Set-Cookie`가 있다.
![](https://my-study.s3.ap-northeast-2.amazonaws.com/HTTP%20%EB%A9%94%EC%8B%9C%EC%A7%80%20/%20Pasted%20image%2020240311202316.png)
___
### 상태코드 조금 더 자세히

메서드가 서버에게 무엇을 해야하는지 말해주는 것처럼 상태 코드는 클라이언트에게 무엇이 일어났는지 말해준다. 상태 코드는 번호로 구분되며 각 범위 대로 의미하는 바가 상이하다.
![](https://my-study.s3.ap-northeast-2.amazonaws.com/HTTP%20%EB%A9%94%EC%8B%9C%EC%A7%80%20/%20Pasted%20image%2020240311204326.png)
#### 200-299 : 성공 상태 코드
- **200 OK**: 요청은 정상이고, 엔티티 본문은 요청된 리소스를 포함하고 있음
- **201 Created**: 서버 리소스를 생성 요청(예: POST)에 대한 응답

#### 300-399 : 리다이렉션 상태 코드
클라이언트가 관심있어하는 리소스에 대해 다른 위치를 사용 하라고 말해주거나 그 리소스의 내용 대신 다른 대안 응답을 제공한다. 

- **301 Moved Permanently**: 요청한 URL이 옮겨졌을 때 사용
- 302 Found: 301과 같음.
- 303 See Other: 다른 URL 필요. POST 응답으로 사용
- **304 Not Modified**: GET과 함께 수정 일에 대한 조건부 헤더를 보낸 경우. 수정되지 않은 경우 사용
- 305 Use Proxy: 리소스가 프락시를 통해야 함. 하지만 이는 보안 문제를 일으킬 수 있다.

#### 400-499 : 클라이언트 에러 상태 코드
- **400 Bad Request: 클라이언트의 요청이 잘못된 경우**
- **401 Unauthorized: 인증이 필요한 경우**
- **403 Forbidden**: 권한 문제가 발생한 경우
- **404 Not Found**: 서버가 요청한 URL을 찾을 수 없을 때 사용
- **405 Method Not Allowed**: 요청한 URL에 대해, 지원하지 않는 메서드로 요청 받았을 때 사용
- 406 Not Acceptable: 클라이언트가 받을 수 없는 리소스
- **408 Request Timeout**: 클라이언트의 요청을 완수하기에 시간이 너무 많이 걸리는 경우, 서버는 이 상태 코드로 응답하고 연결을 끊을 수 있음
- **422 Unprocessable Entity**: 해석 가능한 Content-Type의 엔티티이지만, 데이터 필드 등이 유효하지 않은 경우 (하지만 표준은 아님)

#### 500-599 : 서버 에러 상태 코드
- **500 Internal Server Error**: 서버가 요청을 처리할 수 없게 만드는 에러는 만났을 때 사용
- 501 Not Implemented: 서버가 지원하지 않는 요청
- **502 Bad Gateway**: Gateway로 부터 올바른 응답을 받지 못했을 때 사용
- **503 Service Unavailable**: 현재는 서버가 요청을 처리해 줄 수 없지만 나중에는 가능함을 의미
- **504 Gateway Timeout**: 다른 서버에게 요청을 보내고 응답을 기다리다가 타임아웃이 발생한 Gateway나 Proxy에서 온 응답

___
### 숙제
* 401 VS 403은 언제 사용해야 적절할까?
* 502 Bad Gateway는 정확히 언제 발생할까