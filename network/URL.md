#http #applicationlayer 

___
### 출처
* [쿼리 VS 패스](https://stackoverflow.com/questions/30967822/when-do-i-use-path-params-vs-query-params-in-a-restful-api)
* [쿼리 VS 바디](https://stackoverflow.com/questions/25385559/rest-api-best-practices-args-in-query-string-vs-in-request-body)
* [URI vs URL vs URN :: 마이구미](https://mygumi.tistory.com/139)
___
### 개요
* [[#URL을 조금 자세하게]]
* [[#URL의 구조]]
* [[#쿼리 파라미터 VS 패스 파라미터]]
* [[#URL 인코딩]]
* [[#URI vs URL vs URN]]
___
### URL을 조금 자세하게

우리는 [[HTTP 개관#URL|URL 기초]] 를 살펴보며 URL이 네트워크 상에서 특정한 자원을 지칭하기 위한 식별자라는 것을 학습했다. 또한 URL이 없던 암흑의 시기와 다양한 스킴들을 살펴보며 URL이 비단 HTTP에서만 사용 가능한 것이 아니라는 것을 파악했다.
이제 URL의 실질적인 구조와 URL과 관련된 자세한 내용들을 학습해보자.
___
### URL의 구조

URL은 다음의 구조를 갖는다. 
`<스킴>://<사용자이름>:<비밀번호>@<호스트>:<포트>/<경로>;<파라미터>?<질의>#<프래그먼트>`
여기서 근래도 사용하는 주요한 속성들만 훑어보자.

| 컴포넌트   | 설명                                       |     |     |
| ------ | ---------------------------------------- | --- | --- |
| 스킴     | 사용할 프로토콜                                 |     |     |
| 사용자 이름 | 사용자 이름 (ssh 접속 등에 활용 된다)                 |     |     |
| 비밀번호   | 사용자 비밀번호                                 |     |     |
| 호스트    | 리소스를 호스팅하는 서버의 명이나 IP 주소                 |     |     |
| 포트     | 호스팅 서버의 포트번호                             |     |     |
| 경로     | 서버 내부의 리소스의 위치                           |     |     |
| 질의(쿼리) | URL 뒤 ?이후에 전달되는 값으로 서버에 파라미터를 전달할 때 사용   |     |     |
| 프래그먼트  | 페이지의 특정한 부분으로 이동할 때 사용한다. HTML 내부의 링크이다. |     |     |
> **사용자 이름과 비밀번호?**
	사용자 이름과 비밀번호는 ssh 접속시 사용했던 기억이 날 것이다.
	ssh -i ~/.ssh/key.pem ubuntu@12.201.11.82.. 와 같은 방식으로 ssh 접속을 할때 사용자 이름과 비밀번호 호스트 주소를 전달해 접근했다.

> **쿼리는 언제 사용하면 좋을까?**
	쿼리는 **경로를 통해 전달할 수 없는 데이터를 전달하기 위해 설계돼 주로 GET 리퀘스트에서 특정 리소스를 지정하기 위해서 활용된다.** 하지만, 다른 메서드에서 활용이 불가능한 것은 아니다. ==**POST나 DELETE 메서드에서도 쿼리 문자열을 사용할 수 있다.**== ([참고](https://stackoverflow.com/questions/611906/http-post-with-url-query-parameters-good-idea-or-not))

___
### 쿼리 파라미터 VS 패스 파라미터

벡엔드 개발자라면 API를 설계할 때 이러한 고민을 계속해서 맞닥뜨리게 된다. API를 설계할 때 패스 파라미터와 쿼리 파라미터를 어떻게 적절히 사용해야 할까?

<span class="red red-bg">패스 파라미터는 자원을 명확히 지정할때 활용한다. 쿼리 파라미터는 정렬 혹은 필터링을 진행할때 활용한다. 네이버 쇼핑을 예시로 접근해보자.</span>

네이버 쇼핑에서 남성 패션 카테고리를 클릭하면 아래의 URL로 이동한다. 카테고리 이후에 위치하는 숫자는 남성 패션에 해당하는 번호가 된다.
https://search.shopping.naver.com/search/category/100000002

이후 여기서 내가 아디다스 제품만 보고 싶다고 가정해보자. 만약 패스 파라미터로 구분한다면 다음과 같이 설계 해야할 것이다.
https://search.shopping.naver.com/search/category/100000002/brand/662

이러한 URL은 어색하게 다가오는데 이는 ==**브랜드가 남성 패션 카테고리 하위에 전부 포함되는 속성이 아니기 때문이다.**== 아디다스는 여성 복도 만들고 패션 뿐만 아니라 스포츠 용품도 제작한다. 따라서 만약 이러한 구조를 가진다면 각각의 카테고리 이하에 전부 아디다스가 존재해야할 것이다. 문제점은 각각의 카테고리 이하에 브랜드가 존재하더라도 ==**브랜드가 카테고리 하위에 속하는 구조 자체는 기시감을 준다.**==

**명확히 하위 카테고리에 속하지 않고 브랜드는 상품의 속성으로써 존재**한다. 따라서 남성 패션 카테고리에서 아디다스 브랜드 정보만 획득하는 것은 아디다스 속성을 소유하고 있는 상품만 필터링해서 조회하는 방식으로 동작할 것이다. 마찬가지의 원리로 가격 대 검색이나 색상 검색 역시 필터링을 기반으로 작동해야 한다.

<span class="red red-bg">이때 필터링이나 정렬을 활용하는 경우 쿼리 파라미터를 사용하는 것이 더욱 적절 하므로 네이버 쇼핑에서 브랜드 URL은 아래와 같이 활용하는 것이 적절하다.</span>

https://search.shopping.naver.com/search/category/100000002?brand=667

>[!info]
>**쿼리 파라미터는 필터, 정렬에 활용하고 패스 파라미터는 계층적인 관계 묘사가 어색하지 않고 자원을 명확히 지칭할 수 있을때 사용한다.**

___
### URL 인코딩

URL에는 바로 사용하기 위험한 문자들이 몇가지 존재하는데 ?,/,: 등이 대표적이다. 이러한 문자들은 URL에서 곧장 사용할 경우 오작동을 유발할 수 있기 때문에 별도의 인코딩 작업을 진행한 후 처리한다. 
이러한 인코딩 작업은 초기 영어권에서 특수 문자 지원을 위해 사용했지만, 인터넷이 확대되며 비 영어권 문자를 적용하기 위해서도 사용됐다.

URL 인코딩은 크롬 등의 브라우저에서 자동적으로 처리해주는 경우도 있지만, 코드를 통해서 HTTP 리퀘스트를 전송하고 싶은 경우 반드시 처리해줘야 한다. 

https://ko.wikipedia.org/wiki/%EC%95%84%EC%9D%B4%EC%9C%A0

파이썬의 urllib를 활용해 아이유를 인코딩 할 경우 위와 동일한 결과가 도출된다.
```python
from urllib import parse
parse.quote("아이유")
```
___
### URI vs URL vs URN

세개의 요소는 꽤나 자주 등장하는 개념이지만, 서로를 명확히 구분하고자 하면 혼동이 발생하는 경우가 잦다. 아래에서 명확히 짚고 넘어가자.
#### **URI** 
**URI는 가장 큰 개념으로 특정 리소스를 식별하는 통합 자원 식별자 전체를 의미**한다. 인터넷에 존재하는 자원을 식별하기 위해 사용하는 것으로 그 **종류는 URL과 URN이 있다.** URI는 모두 다음의 구조를 따른다. `scheme:[//authority]path[?query][#fragment]`

- **URL**
    가장 익숙한 URI의 종류 중 하나로 자원에 대한 구체적인 위치를 서술하는 방식이다. ==**URL은 자원의 위치를 자세히 명시 해줌으로써 자원을 구별하는 기능**==을 한다.

- **URN**
    **URN은 리소스에 대해 위치에도 영향을 받지 않는 고유한 이름을 부여**한다. URN이 부여된 리소스는 위치 독립적이기 때문에 **리소스의 위치가 변경돼도 문제 없이 동작**한다.

![](https://my-study.s3.ap-northeast-2.amazonaws.com/URL%20/%20Pasted%20image%2020240313134345.png)

- **URI vs URL**
    URI와 URL의 명확한 차이가 무엇일까? **인터넷 상에 URL은 쿼리 스트링을 제외하고 위치 정보 까지만을 의미하고 URI는 전체를 포함한다고 설명하는 글들이 존재하는데 이는 틀렸다. URL 또한 쿼리를 포함한다.**
    
    두 요소의 차이는 개념적인 느낌으로 이해하는 것이 쉽다. ==**URI는 자원을 식별하기 위한 규약을 의마하고 URL은 위치를 통해 자원이 구별되도록 URI를 실질적으로 구체화한 것**==이라고 보면 된다.

#### **URL VS URN**

**URN은 URL의 한계를 극복하기 위해 고안된 방법**이다. <b><u>URL의 경우 위치 기반이기 때문에 기존 리소스의 위치가 변경되면, 부가적으로 리다이렉션 등의 작업을 처리해줘야 한다. </u></b>
하지만 URN은 고유한 이름을 통해 탐색을 실시 하므로 이런 상황이 발생하지 않는다. 

예시를 들자면 우리집 책장 4번째에 위치한 책과 같은 방법으로 자원을 명시할 경우 해당 위치에 놓인 자원이 변경될 경우 별도의 리다이렉트를 해야하지만, 책 자체의 이름으로 구분을 할 경우 책이 책장의 어느 곳에 놓여 있어도 식별이 가능하다.